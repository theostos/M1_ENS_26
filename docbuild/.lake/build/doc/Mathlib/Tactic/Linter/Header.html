<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../../.././style.css"></link><link rel="icon" href="../../.././favicon.svg"></link><link rel="mask-icon" href="../../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../../.././/declarations/declaration-data.bmp" as="image"></link><title>Mathlib.Tactic.Linter.Header</title><script defer="true" src="../../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../../.././";</script><script>const MODULE_NAME="Mathlib.Tactic.Linter.Header";</script><script type="module" src="../../.././jump-src.js"></script><script type="module" src="../../.././search.js"></script><script type="module" src="../../.././expand-nav.js"></script><script type="module" src="../../.././how-about.js"></script><script type="module" src="../../.././instances.js"></script><script type="module" src="../../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Mathlib</span>.<span class="name">Tactic</span>.<span class="name">Linter</span>.<span class="name">Header</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover-community/mathlib4/blob/32d24245c7a12ded17325299fd41d412022cd3fe/Mathlib/Tactic/Linter/Header.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../../.././Init.html">Init</a></li><li><a href="../../.././Lean/Elab/Command.html">Lean.Elab.Command</a></li><li><a href="../../.././Lean/Elab/ParseImportsFast.html">Lean.Elab.ParseImportsFast</a></li><li><a href="../../.././Mathlib/Tactic/Linter/DirectoryDependency.html">Mathlib.Tactic.Linter.DirectoryDependency</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Mathlib.Tactic.Linter.Header" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.getImportIds"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">getImportIds</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.copyrightHeaderChecks"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">copyrightHeaderChecks</span></a></div><div class="nav_link"><a class="break_within" href="#Mathlib.Linter.linter.style.header"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">style</span>.<span class="name">header</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="The-header-linter">The &quot;header&quot; linter <a class="hover-link" href="#The-header-linter">#</a></h1><p>The &quot;header&quot; style linter checks that a file starts with</p><pre><code>/-
Copyright ...
Apache ...
Authors ...
-/

import statements*
module doc-string*
remaining file
</code></pre><p>It emits a warning if</p><ul>
<li>the copyright statement is malformed;</li>
<li><code>Mathlib.Tactic</code> is imported;</li>
<li>any import in <code>Lake</code> is present;</li>
<li>the first non-<code>import</code> command is not a module doc-string.</li>
</ul><p>The linter allows <code>import</code>-only files and does not require a copyright statement in <code>Mathlib.<a href="../../.././Init.html">Init</a></code>.</p><h2 class="markdown-heading" id="Implementation">Implementation <a class="hover-link" href="#Implementation">#</a></h2><p>The strategy used by the linter is as follows.
The linter computes the end position of the first module doc-string of the file,
resorting to the end of the file, if there is no module doc-string.
Next, the linter tries to parse the file up to the position determined above.</p><p>If the parsing is successful, the linter checks the resulting <code>Syntax</code> and behaves accordingly.</p><p>If the parsing is not successful, this already means there is some &quot;problematic&quot; command
after the imports. In particular, there is a command that is not a module doc-string
immediately following the last import: the file should be flagged by the linter.
Hence, the linter then falls back to parsing the header of the file, adding a spurious <code>section</code>
after it.
This makes it possible for the linter to check the entire header of the file, emit warnings that
could arise from this part and also flag that the file should contain a module doc-string after
the <code>import</code> statements.</p></div><div class="decl" id="Mathlib.Linter.getImportIds"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/32d24245c7a12ded17325299fd41d412022cd3fe/Mathlib/Tactic/Linter/Header.lean#L72-L85">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/Header.html#Mathlib.Linter.getImportIds"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">getImportIds</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> <a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a></span></div></div><p><code><a href="../../.././Mathlib/Tactic/Linter/Header.html#Mathlib.Linter.getImportIds">getImportIds</a> s</code> takes as input <code>s : Syntax</code>.
It returns the array of all <code>import</code> identifiers in <code>s</code>.</p></div></div><div class="decl" id="Mathlib.Linter.copyrightHeaderChecks"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/32d24245c7a12ded17325299fd41d412022cd3fe/Mathlib/Tactic/Linter/Header.lean#L150-L228">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/Header.html#Mathlib.Linter.copyrightHeaderChecks"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">copyrightHeaderChecks</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">copyright</span> : <a href="../../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Array">Array</a> (<a href="../../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> <a href="../../.././Init/Prelude.html#Prod">×</a> <a href="../../.././Init/Prelude.html#String">String</a>)</span></div></div><p>The main function to validate the copyright string.
The input is the copyright string, the output is an array of <code>Syntax × <a href="../../.././Init/Prelude.html#String">String</a></code> encoding:</p><ul>
<li>the <code>Syntax</code> factors are atoms whose ranges are &quot;best guesses&quot; for where the changes should
take place; the embedded string is the current text that the linter flagged;</li>
<li>the <code><a href="../../.././Init/Prelude.html#String">String</a></code> factor is the linter message.</li>
</ul><p>The linter checks that</p><ul>
<li>the first and last line of the copyright are a <code>(&quot;/-&quot;, &quot;-/&quot;)</code> pair, each on its own line;</li>
<li>the first line is begins with <code>Copyright (c) 20</code> and ends with <code>. All rights reserved.</code>;</li>
<li>the second line is <code>Released under Apache 2.0 license as described in the file LICENSE.</code>;</li>
<li>the remainder of the string begins with <code>Authors: </code>, does not end with <code>.</code> and
contains no <code>and</code> nor a double space, except possibly after a line break.</li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Mathlib.Linter.copyrightHeaderChecks" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Mathlib.Linter.linter.style.header"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover-community/mathlib4/blob/32d24245c7a12ded17325299fd41d412022cd3fe/Mathlib/Tactic/Linter/Header.lean#L251-L275">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../../.././Mathlib/Tactic/Linter/Header.html#Mathlib.Linter.linter.style.header"><span class="name">Mathlib</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">style</span>.<span class="name">header</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>The &quot;header&quot; style linter checks that a file starts with</p><pre><code>/-
Copyright ...
Apache ...
Authors ...
-/

import statements*
module doc-string*
remaining file
</code></pre><p>It emits a warning if</p><ul>
<li>the copyright statement is malformed;</li>
<li><code>Mathlib.Tactic</code> is imported;</li>
<li>any import in <code>Lake</code> is present;</li>
<li>the first non-<code>import</code> command is not a module doc-string.</li>
</ul><p>The linter allows <code>import</code>-only files and does not require a copyright statement in <code>Mathlib.<a href="../../.././Init.html">Init</a></code>.</p></div></div></main>
<nav class="nav"><iframe src="../../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>